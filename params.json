{"name":"NVDSP","tagline":"iOS/OSX DSP for audio (Novocaine)","body":"## Audio Filters on iOS and OSX\r\n[![DOI](https://zenodo.org/badge/6288/bartolsthoorn/NVDSP.png)](http://dx.doi.org/10.5281/zenodo.12415)\r\n\r\nImplement high quality audio filters with just a few lines of code and [Novocaine](https://github.com/alexbw/novocaine), or your own audio library of choice.\r\n\r\nNVDSP comes with a wide variety of audio filters:\r\n\r\n+ All Pass Filter (NVAllpassFilter)\r\n+ Band Pass Filter, 0dB gain (NVBandpassFilter)\r\n+ Band Pass Filter, Q gain (NVBandpassQPeakGainFilter)\r\n+ High Pass Filter (NVHighpassFilter)\r\n+ High Shelving Filter (NVHighShelvingFilter)\r\n+ Low Shelving Filter (NVLowShelvingFilter)\r\n+ Low Pass Filter (NVLowPassFilter)\r\n+ Notch Filter (NVNotchFilter)\r\n+ Peaking EQ Filter (NVPeakingEQFilter)\r\n\r\n### Combining it with Novocaine (highpass filter)\r\nTo start out I recommend you to get a fresh copy of [Novocaine](https://github.com/alexbw/novocaine) and open Novocaine's excellent example project. Then import NVDSP and the Filters folder and start your filtering journey.\r\n``` objective-c\r\n// ... import Novocaine here ... \r\n#import \"NVDSP/NVDSP.h\"\r\n#import \"NVDSP/Filters/NVHighpassFilter.h\"\r\n\r\n// init Novocaine audioManager\r\naudioManager = [Novocaine audioManager];\r\nfloat samplingRate = audioManager.samplingRate;\r\n\r\n// init fileReader which we will later fetch audio from\r\nNSURL *inputFileURL = [[NSBundle mainBundle] URLForResource:@\"Trentemoller-Miss-You\" withExtension:@\"mp3\"];\r\n\r\nfileReader = [[AudioFileReader alloc] \r\n                  initWithAudioFileURL:inputFileURL \r\n                  samplingRate:audioManager.samplingRate\r\n                  numChannels:audioManager.numOutputChannels];\r\n\r\n// setup Highpass filter\r\nNVHighpassFilter *HPF;\r\nHPF = [[NVHighpassFilter alloc] initWithSamplingRate:samplingRate];\r\n\r\nHPF.cornerFrequency = 2000.0f;\r\nHPF.Q = 0.5f;\r\n\r\n// setup audio output block\r\n[fileReader play];\r\n[audioManager setOutputBlock:^(float *outData, UInt32 numFrames, UInt32 numChannels) {\r\n    [fileReader retrieveFreshAudio:outData numFrames:numFrames numChannels:numChannels];\r\n    \r\n    [HPF filterData:outData numFrames:numFrames numChannels:numChannels];\r\n}];\r\n```\r\nNote that NVDSP works with raw audio buffers, so it can also work with other libraries instead of Novocaine.\r\n\r\n### More examples\r\n#### Peaking EQ filter\r\n``` objective-c\r\n// import Novocaine.h and NVDSP.h\r\n#import \"NVDSP/Filter/NVPeakingEQFilter.h\"\r\nNVPeakingEQFilter *PEF = [[NVPeakingEQFilter alloc] initWithSamplingRate:audioManager.samplingRate];\r\nPEF.centerFrequency = 1000.0f;\r\nPEF.Q = 3.0f;\r\nPEF.G = 20.0f;\r\n[PEF filterData:data numFrames:numFrames numChannels:numChannels];\r\n```\r\n\r\n#### Lowpass filter\r\n``` objective-c\r\n// import Novocaine.h and NVDSP.h\r\n#import \"NVDSP/Filter/NVLowpassFilter.h\"\r\nNVLowpassFilter *LPF = [[NVLowpassFilter alloc] initWithSamplingRate:audioManager.samplingRate];\r\nLPF.cornerFrequency = 800.0f;\r\nLPF.Q = 0.8f;\r\n[LPF filterData:data numFrames:numFrames numChannels:numChannels];\r\n```\r\n\r\n#### Notch filter\r\n``` objective-c\r\n// import Novocaine.h and NVDSP.h\r\n#import \"NVDSP/Filter/NVNotchFilter.h\"\r\nNVNotchFilter *NF = [[NVNotchFilter alloc] initWithSamplingRate:audioManager.samplingRate];\r\nNF.centerFrequency = 3000.0f;\r\nNF.Q = 0.8f;\r\n[NF filterData:data numFrames:numFrames numChannels:numChannels];\r\n```\r\n\r\n#### Bandpass filter\r\nThere are two types of bandpass filters:\r\n\r\n    * 0 dB gain bandpass filter (NVBandpassFilter.h)\r\n    * Peak gain Q bandpass filter (NVBandpassQPeakGainFilter.h)\r\n\r\n``` objective-c\r\n// import Novocaine.h and NVDSP.h\r\n#import \"NVDSP/Filter/NVBandpassFilter.h\"\r\nNVBandpassFilter *BPF = [[NVBandpassFilter alloc] initWithSamplingRate:audioManager.samplingRate];\r\nBPF.centerFrequency = 2500.0f;\r\nBPF.Q = 0.9f;\r\n[BPF filterData:data numFrames:numFrames numChannels:numChannels];\r\n```\r\n\r\n#### Measure dB level (ranging from -51.0f to 0.0f)\r\n``` objective-c\r\n// import Novocaine.h and NVDSP.h\r\n#import \"NVDSP/Utilities/NVSoundLevelMeter.h\"\r\nNVSoundLevelMeter *SLM = [[NVSoundLevelMeter alloc] init];\r\nfloat dB = [SLM getdBLevel:outData numFrames:numFrames numChannels:numChannels];\r\nNSLog(@\"dB level: %f\", dB);\r\n// NSLogging in an output loop will most likely cause hickups/clicky noises, but it does log the dB level!\r\n// To get a proper dB value, you have to call the getdBLevel method a few times (it has memory of previous values)\r\n// You call this inside the input or outputBlock: [audioManager setOutputBlock:^...\r\n```\r\n\r\n#### Applying overall gain. \r\nAll sample values (typically -1.0f .. 1.0f when not clipping) are multiplied by the gain value.\r\n``` objective-c\r\n// import Novocaine.h and NVDSP.h\r\nNVDSP *generalDSP = [[NVDSP alloc] init];\r\n[generalDSP applyGain:outData length:numFrames*numChannels gain:0.8];\r\n```\r\n\r\n#### Convert stereo (left/right) to mono\r\nThis converts a left and right buffer into a mono signal. It takes the average of the samples.\r\n```objective-c\r\n// Deinterleave stereo buffer into seperate left and right\r\nfloat *left = (float *)malloc((numFrames + 2) * sizeof(float));\r\nfloat *right = (float *)malloc((numFrames + 2) * sizeof(float));\r\n[generalDSP deinterleave:data left:left right:right length:numFrames];\r\n\r\n// Convert left and right to a mono 2 channel buffer\r\n[generalDSP mono:data left:left right:right length:numFrames];\r\n\r\n// Free buffers\r\nfree(left);\r\nfree(right);\r\n```\r\n\r\n### Clipping\r\nMultiple peaking EQs with high gains can cause clipping. Clipping is basically sample data that exceeds the maximum or minimum value of 1.0f or -1.0f respectively. Clipping will cause really loud and dirty noises, like a bad overdrive effect. You can use the method `counterClipping` to prevent clipping (it will reduce the sound level).\r\n\r\n``` objective-c\r\n// import Novocaine.h and NVDSP.h\r\n#import \"NVDSP/Utilities/NVClippingDetection.h\"\r\nNVClippingDetection *CDT = [[NVClippingDetection alloc] init];\r\n// ... possible clipped outData ...//\r\n[CDT counterClipping:outData numFrames:numFrames numChannels:numChannels];\r\n// ... outData is now safe ...//\r\n\r\n// or get the amount of clipped samples:\r\n - (float) getClippedSamples:(float *)data numFrames:(UInt32)numFrames numChannels:(UInt32)numChannels;\r\n// or get the percentage of clipped samples:\r\n - (float) getClippedPercentage:(float*)data numFrames:(UInt32)numFrames numChannels:(UInt32)numChannels;\r\n// or get the maximum value of a clipped sample that was found\r\n - (float) getClippingSample:(float *)data numFrames:(UInt32)numFrames numChannels:(UInt32)numChannels;\r\n```\r\n\r\n### Example project\r\nSee `/Examples/NVDSPExample` for a simple iOS XCodeProject example. Please note the Novocaine bundled with it might be outdated.\r\n\r\n### A thing to note\r\nThe NVDSP class is written in C++, so the classes that use it will have to be Objective-C++. Change all the files that use NVDSP from MyClass.m to MyClass.mm.\r\n\r\n### Thanks to\r\nAlex Wiltschko - Creator of [Novocaine](http://alexbw.github.com/novocaine/)\r\n\r\nYasoshima - Writer of [this article](http://objective-audio.jp/2008/02/biquad-filter.html), revealing how vDSP_deq22 works. (and google translate, I don't speak Japanese)\r\n\r\nhrnt - Helpful on IRC #iphonedev (freenode)\r\n","google":"UA-5535798-10","note":"Don't delete this file! It's used internally to help with page regeneration."}